<?xml version="1.0" encoding="UTF-8"?>
<context>
    <story>
        <id>2-2</id>
        <title>Feed Organization and Management</title>
        <status>drafted</status>
        <epic>RSS Feed Management (Epic 2)</epic>
    </story>

    <business-context>
        <problem-statement>
            Users with multiple RSS feeds need better ways to organize and manage their content sources.
            Without organization, users struggle to find specific feeds, control which feeds are active,
            and maintain their feed collection as it grows.
        </problem-statement>

        <user-needs>
            <need priority="high">Categorize feeds by topic or source type</need>
            <need priority="high">Activate/deactivate feeds without deleting them</need>
            <need priority="medium">Edit feed metadata (titles, descriptions)</need>
            <need priority="medium">Bulk operations for managing multiple feeds</need>
            <need priority="low">Drag-and-drop reordering within categories</need>
        </user-needs>

        <business-value>
            <value>Improved user experience for feed management</value>
            <value>Better content source control and organization</value>
            <value>Scalability for users with many feeds</value>
            <value>Foundation for advanced feed processing features</value>
        </business-value>
    </business-context>

    <technical-context>
        <current-state>
            <database-schema>
                <table name="feeds">
                    <columns>
                        <column name="id" type="String" constraints="primary key"/>
                        <column name="userId" type="String" constraints="foreign key"/>
                        <column name="url" type="String" constraints="unique per user"/>
                        <column name="title" type="String" nullable="true"/>
                        <column name="description" type="String" nullable="true"/>
                        <column name="category" type="String" nullable="true"/>
                        <column name="isActive" type="Boolean" default="true"/>
                        <column name="lastFetched" type="DateTime" nullable="true"/>
                        <column name="createdAt" type="DateTime"/>
                        <column name="updatedAt" type="DateTime"/>
                    </columns>
                </table>
            </database-schema>

            <existing-components>
                <component name="FeedAdditionForm" path="src/components/FeedAdditionForm.tsx">
                    <purpose>Add new RSS feeds with validation</purpose>
                    <technologies>React Hook Form, Zod, Tailwind CSS</technologies>
                </component>

                <component name="ContentService" path="src/services/database/contentService.ts">
                    <purpose>Database operations for feeds and content</purpose>
                    <methods>addFeed, getUserFeeds, updateFeed, deleteFeed</methods>
                </component>

                <page name="FeedsPage" path="app/feeds/page.tsx">
                    <purpose>Main feed management interface</purpose>
                    <features>Feed list display, add/delete operations</features>
                </page>
            </existing-components>
        </current-state>

        <implementation-considerations>
            <ui-requirements>
                <requirement>Category-based organization with collapsible sections</requirement>
                <requirement>Inline editing for feed metadata</requirement>
                <requirement>Status toggles with immediate visual feedback</requirement>
                <requirement>Confirmation dialogs for destructive actions</requirement>
                <requirement>Responsive design for mobile and desktop</requirement>
            </ui-requirements>

            <data-operations>
                <operation>Update feed categories and metadata</operation>
                <operation>Toggle feed active/inactive status</operation>
                <operation>Bulk operations for multiple feeds</operation>
                <operation>Soft delete with recovery options</operation>
            </data-operations>

            <performance-considerations>
                <consideration>Efficient database queries for categorized feeds</consideration>
                <consideration>Optimistic UI updates for better responsiveness</consideration>
                <consideration>Lazy loading for large feed collections</consideration>
            </performance-considerations>
        </implementation-considerations>
    </technical-context>

    <acceptance-criteria>
        <criterion id="AC1">
            <given>User has multiple RSS feeds</given>
            <when>User views feed list</when>
            <then>Feeds are organized by category</then>
        </criterion>

        <criterion id="AC2">
            <given>User wants to change feed category</given>
            <when>User edits feed category</when>
            <then>Category change is saved immediately</then>
        </criterion>

        <criterion id="AC3">
            <given>User wants to deactivate a feed</given>
            <when>User toggles feed status</when>
            <then>Feed becomes inactive and stops processing</then>
        </criterion>

        <criterion id="AC4">
            <given>User wants to remove a feed</given>
            <when>User deletes feed</when>
            <then>Feed is removed with confirmation dialog</then>
        </criterion>
    </acceptance-criteria>

    <implementation-plan>
        <phase name="Phase 1: Category Management" duration="2 days">
            <task>Create category management interface</task>
            <task>Add default categories to database</task>
            <task>Implement category CRUD operations</task>
            <task>Update feed addition to include category selection</task>
        </phase>

        <phase name="Phase 2: Feed Status Management" duration="2 days">
            <task>Add activate/deactivate toggles</task>
            <task>Implement bulk operations</task>
            <task>Add status indicators and filtering</task>
            <task>Update UI with status management</task>
        </phase>

        <phase name="Phase 3: Feed Editing" duration="2 days">
            <task>Implement inline editing for feed metadata</task>
            <task>Add edit forms and validation</task>
            <task>Update feed list UI with editing capabilities</task>
            <task>Add undo functionality for accidental changes</task>
        </phase>

        <phase name="Phase 4: Enhanced UI" duration="1 day">
            <task>Implement category-based organization</task>
            <task>Add drag-and-drop reordering</task>
            <task>Improve feed list layout and interactions</task>
            <task>Add keyboard shortcuts for power users</task>
        </phase>
    </implementation-plan>

    <testing-strategy>
        <unit-tests>
            <test>Category CRUD operations</test>
            <test>Feed status toggle logic</test>
            <test>Bulk operation handlers</test>
            <test>Form validation for editing</test>
        </unit-tests>

        <integration-tests>
            <test>Complete category management workflow</test>
            <test>Feed editing and saving</test>
            <test>Status changes and persistence</test>
            <test>UI state management</test>
        </integration-tests>

        <ui-tests>
            <test>Drag-and-drop functionality</test>
            <test>Keyboard navigation</test>
            <test>Screen reader compatibility</test>
            <test>Mobile responsiveness</test>
        </ui-tests>
    </testing-strategy>

    <dependencies>
        <dependency type="story" id="2-1" status="completed">
            RSS Feed Addition Interface provides the foundation
        </dependency>

        <dependency type="database">
            Existing feed table schema supports all required operations
        </dependency>

        <dependency type="ui-components">
            Badge, Button, Input components from shadcn/ui
        </dependency>
    </dependencies>

    <risks-and-mitigations>
        <risk level="medium">
            <description>Complex UI interactions may impact performance</description>
            <mitigation>Implement virtual scrolling for large feed lists</mitigation>
        </risk>

        <risk level="low">
            <description>Category management could become complex</description>
            <mitigation>Start with simple category assignment, add advanced features later</mitigation>
        </risk>

        <risk level="low">
            <description>Drag-and-drop may not work well on mobile</description>
            <mitigation>Provide alternative reordering methods for mobile</mitigation>
        </risk>
    </risks-and-mitigations>

    <success-metrics>
        <metric name="User Satisfaction">Users can easily organize and manage feeds</metric>
        <metric name="Performance">UI remains responsive with 100+ feeds</metric>
        <metric name="Adoption">90% of users utilize categorization features</metric>
        <metric name="Error Rate">Less than 1% of feed management operations fail</metric>
    </success-metrics>
</context>