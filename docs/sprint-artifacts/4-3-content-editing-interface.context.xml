<?xml version="1.0" encoding="UTF-8"?>
<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>3</storyId>
    <title>content-editing-interface</title>
    <status>drafted</status>
    <generatedAt>2025-11-14T18:13:43.878Z</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/4-3-content-editing-interface.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>As a user</asA>
    <iWant>I want to edit and refine AI-generated content</iWant>
    <soThat>final content meets my standards</soThat>
    <tasks>- [ ] Display AI-generated blog post in rich text editor
- [ ] Support inline editing with real-time preview
- [ ] Track changes made to original content
- [ ] Save edited content back to database
- [ ] Provide editing tools (formatting, links, images)
- [ ] Integrate with existing Content model for data persistence
- [ ] Implement rich text editor component (React-based)
- [ ] Support content versioning and change history
- [ ] Provide real-time collaboration features
- [ ] Ensure responsive design for different screen sizes
- [ ] Editor loads content within 2 seconds
- [ ] Changes are auto-saved every 30 seconds
- [ ] Support for Markdown and HTML content formats
- [ ] Keyboard shortcuts for common editing operations
- [ ] Accessibility compliance (WCAG 2.1)
- [ ] Store edited content with version history
- [ ] Track editing metadata (time spent, changes made)
- [ ] Link edited content to original AI generation
- [ ] Support content export in multiple formats</tasks>
  </story>

  <acceptanceCriteria>### Functional Requirements
- [ ] Display AI-generated blog post in rich text editor
- [ ] Support inline editing with real-time preview
- [ ] Track changes made to original content
- [ ] Save edited content back to database
- [ ] Provide editing tools (formatting, links, images)

### Technical Requirements
- [ ] Integrate with existing Content model for data persistence
- [ ] Implement rich text editor component (React-based)
- [ ] Support content versioning and change history
- [ ] Provide real-time collaboration features
- [ ] Ensure responsive design for different screen sizes

### Quality Requirements
- [ ] Editor loads content within 2 seconds
- [ ] Changes are auto-saved every 30 seconds
- [ ] Support for Markdown and HTML content formats
- [ ] Keyboard shortcuts for common editing operations
- [ ] Accessibility compliance (WCAG 2.1)

### Data Requirements
- [ ] Store edited content with version history
- [ ] Track editing metadata (time spent, changes made)
- [ ] Link edited content to original AI generation
- [ ] Support content export in multiple formats</acceptanceCriteria>

  <artifacts>
    <docs>
      <artifact path="docs/epics.md" title="Neural Feed Studio - Epic Breakdown" section="Epic 4: AI Content Generation" snippet="Implement multi-agent AI system for generating blog content from selected topics. Stories include outline generation, AI writing, content editing interface, and feedback learning." />
      <artifact path="docs/sprint-artifacts/tech-spec-epic-4.md" title="Technical Specification - Epic 4" section="Content Editing Requirements" snippet="Rich text editor integration, content versioning, change tracking, and export capabilities for AI-generated content refinement." />
      <artifact path="docs/architecture.md" title="System Architecture" section="Frontend Architecture" snippet="React-based component architecture with state management, API integration, and responsive design patterns." />
      <artifact path="docs/sprint-artifacts/4-2-ai-blog-post-writing.md" title="Story 4.2: AI Blog Post Writing" section="Technical Implementation" snippet="ContentWritingService, API endpoints for content generation, and Content model integration that editing interface must extend." />
    </docs>
    <code>
      <artifact path="src/services/content/contentWritingService.ts" kind="service" symbol="ContentWritingService" lines="1-349" reason="Provides AI-generated content that needs editing interface - understand content structure and generation patterns" />
      <artifact path="src/app/api/content/generate-post/route.ts" kind="api" symbol="POST /api/content/generate-post" lines="1-94" reason="Content generation endpoint pattern to follow for editing endpoints" />
      <artifact path="src/app/api/content/[contentId]/post/route.ts" kind="api" symbol="GET /api/content/[contentId]/post" lines="1-82" reason="Content retrieval endpoint that editing interface will extend" />
      <artifact path="prisma/schema.prisma" kind="model" symbol="Content" lines="1-50" reason="Database model for content storage that editing must integrate with" />
      <artifact path="src/components/" kind="component" symbol="Component Library" lines="1-1000" reason="Existing UI components and patterns for rich text editor integration" />
      <artifact path="src/services/database/contentService.ts" kind="service" symbol="ContentService" lines="1-150" reason="Database operations for content that editing interface must reuse" />
    </code>
    <dependencies>
      <ecosystem name="node">
        <package name="react" version="^18.0.0" type="runtime" />
        <package name="next" version="^14.0.0" type="runtime" />
        <package name="@prisma/client" version="^5.0.0" type="runtime" />
        <package name="prisma" version="^5.0.0" type="dev" />
        <package name="typescript" version="^5.0.0" type="dev" />
        <package name="tailwindcss" version="^3.0.0" type="dev" />
        <package name="jest" version="^29.0.0" type="dev" />
        <package name="@testing-library/react" version="^14.0.0" type="dev" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Follow Next.js App Router patterns for API routes and component structure</constraint>
    <constraint>Use existing Content model and database schema - extend rather than recreate</constraint>
    <constraint>Maintain TypeScript strict mode and proper interface definitions</constraint>
    <constraint>Implement responsive design following Tailwind CSS patterns</constraint>
    <constraint>Ensure accessibility compliance with WCAG 2.1 AA standards</constraint>
    <constraint>Support both Markdown and HTML content formats for editing</constraint>
    <constraint>Implement auto-save functionality with 30-second intervals</constraint>
    <constraint>Track content changes with proper versioning and metadata</constraint>
    <constraint>Integrate with existing authentication and user session management</constraint>
    <constraint>Follow established testing patterns with Jest and React Testing Library</constraint>
  </constraints>

  <interfaces>
    <interface name="Content Editing API" kind="REST endpoint" signature="PUT /api/content/{contentId}/edit" path="src/app/api/content/[contentId]/edit/route.ts" />
    <interface name="Content Retrieval API" kind="REST endpoint" signature="GET /api/content/{contentId}/edit" path="src/app/api/content/[contentId]/edit/route.ts" />
    <interface name="Content Version History API" kind="REST endpoint" signature="GET /api/content/{contentId}/versions" path="src/app/api/content/[contentId]/versions/route.ts" />
    <interface name="Content Export API" kind="REST endpoint" signature="POST /api/content/{contentId}/export" path="src/app/api/content/[contentId]/export/route.ts" />
    <interface name="ContentEditor Component" kind="React component" signature="ContentEditor: React.FC<ContentEditorProps>" path="src/components/ContentEditor.tsx" />
    <interface name="ContentService.editContent" kind="function signature" signature="editContent(contentId: string, edits: ContentEdits): Promise<Content>" path="src/services/database/contentService.ts" />
    <interface name="Content Version Model" kind="database interface" signature="interface ContentVersion { id: string; contentId: string; content: string; changes: ContentChange[]; createdAt: Date; }" path="prisma/schema.prisma" />
  </interfaces>

  <tests>
    <standards>Unit tests for React components using Jest and React Testing Library. Integration tests for API endpoints with mocked database. E2E tests for complete editing workflows using Playwright. Follow existing patterns in __tests__/ directory with proper mocking of external dependencies.</standards>
    <locations>
      <location>__tests__/components/ContentEditor.test.tsx</location>
      <location>__tests__/api/content/[contentId]/edit.test.ts</location>
      <location>__tests__/services/content/contentEditingService.test.ts</location>
      <location>__tests__/integration/content-editing.test.ts</location>
    </locations>
    <ideas>
      <idea ac="FR1">Test rich text editor renders AI-generated content correctly with proper formatting</idea>
      <idea ac="FR2">Verify inline editing updates content in real-time with preview functionality</idea>
      <idea ac="FR3">Test change tracking captures all modifications with timestamps and user attribution</idea>
      <idea ac="FR4">Validate edited content saves to database with proper version history</idea>
      <idea ac="FR5">Test editing tools (bold, italic, links, images) apply formatting correctly</idea>
      <idea ac="TR1">Verify Content model integration maintains data consistency</idea>
      <idea ac="TR2">Test rich text editor component integration with React state management</idea>
      <idea ac="TR3">Validate content versioning creates proper change history</idea>
      <idea ac="TR4">Test responsive design across different screen sizes</idea>
      <idea ac="QR1">Performance test editor loading within 2-second requirement</idea>
      <idea ac="QR2">Test auto-save functionality triggers every 30 seconds</idea>
      <idea ac="QR3">Validate Markdown and HTML format support and conversion</idea>
      <idea ac="QR4">Test keyboard shortcuts for common editing operations</idea>
      <idea ac="QR5">Accessibility testing with screen readers and keyboard navigation</idea>
    </ideas>
  </tests>
</story-context>